import{j as e,R as t,D as a,aN as s,e as r,aO as l,aP as n,Y as i,O as c,ag as d,c as o,B as m,s as x,m as p,aQ as u,aR as h,aS as y,r as g,aw as b,aT as f,a7 as j,E as v,J as N,h as w,a8 as k,af as D,aG as T}from"./chunk-Do_hQOja.js";import{r as S}from"./chunk-rj-8a6OE.js";import{d as C,e as A}from"./index-B4sOzZkQ.js";import{K as E,B as z,A as B,R as F,D as R,M as _,H as P,J as G,u as M,n as I,I as $,Q as K}from"./chunk-SPeBi8oJ.js";import"./chunk-Bkkzv6j4.js";import"./chunk-uNZoKFSG.js";import"./chunk-BXGe81IW.js";const Y=()=>{const[y,g]=S.useState(!0),[b,f]=S.useState(new Date),[j,v]=S.useState([]),[N,w]=S.useState([]),[k,D]=S.useState([]),[T,A]=S.useState([]),[_,P]=S.useState({totalRevenue:0,totalExpenses:0,totalDriversDebt:0,totalDriversCredit:0,cashPayments:0,cardPayments:0,bankTransferPayments:0,todayRevenue:0,todayExpenses:0,monthlyTrend:[]});S.useEffect(()=>{const e=[];return e.push(E(z(C,"reservations"),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));v(t)})),e.push(E(z(C,"users"),e=>{const t=e.docs.filter(e=>"driver"===e.data().role).map(e=>({id:e.id,...e.data()}));w(t)})),e.push(E(z(C,"manual_drivers"),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));D(t)})),e.push(E(B(z(C,"financial_transactions"),R("createdAt","desc"),F(50)),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));A(t),g(!1)})),()=>{e.forEach(e=>e())}},[]),S.useEffect(()=>{G()},[j,N,k,T]);const G=()=>{let e=0,t=0,a=0,s=0,r=0,l=0,n=0,i=0,c=0;const d=new Date,o=new Date(d.getFullYear(),d.getMonth(),d.getDate());j.forEach(t=>{if("completed"===t.status&&t.totalPrice){const a=parseFloat(t.totalPrice)||0;e+=a,"cash"===t.paymentMethod?r+=a:"credit_card"===t.paymentMethod||"card"===t.paymentMethod?l+=a:"bank_transfer"===t.paymentMethod&&(n+=a),t.completedAt&&t.completedAt.toDate()>=o&&(i+=a)}}),T.forEach(e=>{const a=parseFloat(e.amount)||0;"debit"===e.type&&(t+=a,e.createdAt&&e.createdAt.toDate()>=o&&(c+=a))}),N.forEach(e=>{const t=parseFloat(e.balance)||0;t<0?a+=Math.abs(t):t>0&&(s+=t)}),k.forEach(e=>{const t=parseFloat(e.balance)||0;t<0?a+=Math.abs(t):t>0&&(s+=t)});const m=M();P({totalRevenue:e,totalExpenses:t,totalDriversDebt:a,totalDriversCredit:s,cashPayments:r,cardPayments:l,bankTransferPayments:n,todayRevenue:i,todayExpenses:c,monthlyTrend:m}),f(new Date)},M=()=>{const e=[],t=new Date;for(let a=5;a>=0;a--){const s=new Date(t.getFullYear(),t.getMonth()-a,1),r=new Date(t.getFullYear(),t.getMonth()-a+1,0);let l=0,n=0;j.forEach(e=>{"completed"===e.status&&e.completedAt&&e.completedAt.toDate()>=s&&e.completedAt.toDate()<=r&&(l+=parseFloat(e.totalPrice)||0)}),T.forEach(e=>{"debit"===e.type&&e.createdAt&&e.createdAt.toDate()>=s&&e.createdAt.toDate()<=r&&(n+=parseFloat(e.amount)||0)}),e.push({month:s.toLocaleDateString("tr-TR",{month:"short",year:"numeric"}),revenue:l,expenses:n,profit:l-n})}return e},I=e=>{const t=parseFloat(e)||0;return isNaN(t)?"‚Ç¨0":new Intl.NumberFormat("tr-TR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)},$=({title:t,value:a,icon:s,color:r,trend:l,description:n})=>e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`p-6 rounded-xl border-2 ${r} relative overflow-hidden`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(s,{className:"w-8 h-8 opacity-80"}),l&&e.jsxs("div",{className:"flex items-center text-sm font-medium "+(l>0?"text-green-600":"text-red-600"),children:[l>0?e.jsx(u,{className:"w-4 h-4"}):e.jsx(h,{className:"w-4 h-4"}),Math.abs(l),"%"]})]}),e.jsx("div",{className:"text-2xl font-bold mb-1",children:a}),e.jsx("div",{className:"text-sm opacity-80",children:t}),n&&e.jsx("div",{className:"text-xs opacity-60 mt-2",children:n})]}),K=()=>[...T].sort((e,t)=>{const a=e.createdAt?.toDate?.()||new Date(0);return(t.createdAt?.toDate?.()||new Date(0))-a}).slice(0,10);return y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"üìä Finansal Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Son g√ºncelleme: ",b.toLocaleTimeString("tr-TR")]})]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(t,{className:"w-4 h-4"}),"Yenile"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx($,{title:"Toplam Gelir (Ciro)",value:I(_.totalRevenue),icon:a,color:"border-green-200 bg-green-50 text-green-800",description:"T√ºm tamamlanan rezervasyonlar"}),e.jsx($,{title:"Toplam Gider",value:I(_.totalExpenses),icon:s,color:"border-red-200 bg-red-50 text-red-800",description:"≈ûof√∂r √∂demeleri ve manuel giderler"}),e.jsx($,{title:"≈ûof√∂rlerden Alacaklarƒ±m",value:I(_.totalDriversDebt),icon:r,color:"border-blue-200 bg-blue-50 text-blue-800",description:"Nakit √∂demelerden komisyon borcu"}),e.jsx($,{title:"≈ûof√∂rlere √ñdeyeceƒüim",value:I(_.totalDriversCredit),icon:l,color:"border-orange-200 bg-orange-50 text-orange-800",description:"Kart √∂demelerden ≈üof√∂r alacaƒüƒ±"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(n,{className:"w-5 h-5"}),"Gelir Daƒüƒ±lƒ±mƒ±"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx($,{title:"Nakit √ñdemeler",value:I(_.cashPayments),icon:i,color:"border-emerald-200 bg-emerald-50 text-emerald-800",description:`${(_.cashPayments/_.totalRevenue*100||0).toFixed(1)}% toplam gelir`}),e.jsx($,{title:"Kredi Kartƒ±",value:I(_.cardPayments),icon:c,color:"border-blue-200 bg-blue-50 text-blue-800",description:`${(_.cardPayments/_.totalRevenue*100||0).toFixed(1)}% toplam gelir`}),e.jsx($,{title:"Banka Havalesi",value:I(_.bankTransferPayments),icon:d,color:"border-purple-200 bg-purple-50 text-purple-800",description:`${(_.bankTransferPayments/_.totalRevenue*100||0).toFixed(1)}% toplam gelir`})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5"}),"G√ºnl√ºk √ñzet"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:I(_.todayRevenue)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Bug√ºnk√º Gelir"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:I(_.todayExpenses)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Bug√ºnk√º Gider"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold "+(_.todayRevenue-_.todayExpenses>=0?"text-green-600":"text-red-600"),children:I(_.todayRevenue-_.todayExpenses)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Bug√ºnk√º Kar/Zarar"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5"}),"6 Aylƒ±k Trend"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"Ay"}),e.jsx("th",{className:"text-right py-2",children:"Gelir"}),e.jsx("th",{className:"text-right py-2",children:"Gider"}),e.jsx("th",{className:"text-right py-2",children:"Kar/Zarar"})]})}),e.jsx("tbody",{children:_.monthlyTrend.map((t,a)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-3 font-medium",children:t.month}),e.jsx("td",{className:"py-3 text-right text-green-600",children:I(t.revenue)}),e.jsx("td",{className:"py-3 text-right text-red-600",children:I(t.expenses)}),e.jsx("td",{className:"py-3 text-right font-medium "+(t.profit>=0?"text-green-600":"text-red-600"),children:I(t.profit)})]},a))})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(t,{className:"w-5 h-5"}),"Son ƒ∞≈ülem √ñzetleri"]}),K().length>0?e.jsx("div",{className:"space-y-3",children:K().map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+("credit"===t.type?"bg-green-500":"bg-red-500")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.description}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.createdAt?.toDate?.()?.toLocaleDateString("tr-TR")," - ",t.category||"Kategori yok"]})]})]}),e.jsxs("div",{className:"font-semibold "+("credit"===t.type?"text-green-600":"text-red-600"),children:["credit"===t.type?"+":"-",I(t.amount)]})]},t.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(x,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Hen√ºz i≈ülem kaydƒ± bulunmuyor"})]})]})]})},L=async(e,t,a,s,r="")=>{try{const l={id:`payment_${e}_${Date.now()}`,type:"driver_payment",driverId:e,driverType:t,driverName:a,amount:parseFloat(s),note:r,date:new Date,paymentMethod:"manual",category:"driver_expense",processedBy:"admin_manual",createdAt:new Date};await G(z(C,"company_financials"),l);const n={type:"debit",amount:parseFloat(s),description:`≈ûof√∂r √ñdemesi: ${a}${r?` - ${r}`:""}`,category:"≈ûof√∂r √ñdemesi",date:(new Date).toISOString().split("T")[0],source:"driver_payment",driverId:e,driverType:t,driverName:a,createdAt:new Date,createdBy:"admin"};return await G(z(C,"financial_transactions"),n),{success:!0,record:l}}catch(l){throw l}},H=async(e,t,a,s,r="")=>{try{const l={id:`collection_${e}_${Date.now()}`,type:"driver_collection",driverId:e,driverType:t,driverName:a,amount:parseFloat(s),note:r,date:new Date,paymentMethod:"manual",category:"driver_revenue",processedBy:"admin_manual",createdAt:new Date};await G(z(C,"company_financials"),l);const n={type:"credit",amount:parseFloat(s),description:`≈ûof√∂rden Tahsilat: ${a}${r?` - ${r}`:""}`,category:"≈ûof√∂rden Tahsilat",date:(new Date).toISOString().split("T")[0],source:"driver_collection",driverId:e,driverType:t,driverName:a,createdAt:new Date,createdBy:"admin"};return await G(z(C,"financial_transactions"),n),{success:!0,record:l}}catch(l){throw l}},O=()=>{const[t,a]=S.useState(!0),[l,n]=S.useState([]),[i,c]=S.useState([]),[d,o]=S.useState(""),[m,x]=S.useState("all"),[u,h]=S.useState(null),[k,D]=S.useState(!1),[T,E]=S.useState(!1),[F,G]=S.useState({type:"payment",amount:"",note:""});S.useEffect(()=>{(async()=>{try{a(!0);const e=await P(z(C,"users")),t=[];e.docs.forEach(e=>{const a=e.data();"driver"===a.role&&t.push({id:e.id,...a,type:"regular",displayName:`${a.firstName} ${a.lastName}`,commission:a.commission||15})});const s=await P(z(C,"manual_drivers")),r=[];s.docs.forEach(e=>{const t=e.data();r.push({id:e.id,...t,type:"manual",displayName:t.name,commission:0})}),t.sort((e,t)=>e.firstName?.localeCompare(t.firstName)||0),r.sort((e,t)=>e.name?.localeCompare(t.name)||0),n(t),c(r),t.forEach(e=>{})}catch(e){A.error("≈ûof√∂r verileri y√ºklenirken hata olu≈ütu")}finally{a(!1)}})()},[]);const $=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(e||0),K=e=>e>0?{color:"text-red-600",bg:"bg-red-50",border:"border-red-200",icon:y,text:"Bor√ßlu (Size)",description:"≈ûofore √∂demeniz gereken tutar"}:e<0?{color:"text-green-600",bg:"bg-green-50",border:"border-green-200",icon:s,text:"Alacaklƒ± (Sizden)",description:"≈ûof√∂rden alacaƒüƒ±nƒ±z tutar"}:{color:"text-gray-600",bg:"bg-gray-50",border:"border-gray-200",icon:g,text:"Dengeli",description:"Hesap kapalƒ±"},Y=async e=>{try{h(e);let a=null;try{a=await(async(e,t="regular")=>{try{const a=B(z(C,"company_financials"),_("driverId","==",e),R("date","desc")),s=(await P(a)).docs.map(e=>({id:e.id,...e.data()})),r=s.filter(e=>"reservation_completion"===e.type),l=s.filter(e=>"driver_payment"===e.type),n=s.filter(e=>"driver_collection"===e.type),i=r.reduce((e,t)=>(t.driverType,e+(t.companyExpense||0)),0),c=l.reduce((e,t)=>e+(t.amount||0),0),d=n.reduce((e,t)=>e+(t.amount||0),0),o=i-c+d;return{driverId:e,driverType:t,totalEarnings:i,totalPayments:c,totalCollections:d,netBalance:o,reservationCount:r.length,records:{reservations:r,payments:l,collections:n},summary:{averageEarningPerReservation:r.length>0?(i/r.length).toFixed(2):0,isProfitable:o>0}}}catch(a){throw a}})(e.id,e.type)}catch(t){a={totalEarnings:0,reservationCount:0,totalPayments:0,netBalance:e.balance||0}}let s=[];try{s=await O(e.id,e.type)}catch(t){s=[]}let r=null;try{r=U(e,a)}catch(t){r={totalTrips:0,avgEarningPerTrip:0,recentActivityCount:0,lastActivityDate:null,cashTrips:0,cardTrips:0,totalCashCommission:0,totalCardEarnings:0}}h(e=>({...e,financialSummary:a,recentReservations:s,performanceStats:r})),E(!0)}catch(t){A.error(`≈ûof√∂r detaylarƒ± y√ºklenirken hata olu≈ütu: ${t.message}`),h(t=>({...t,financialSummary:{totalEarnings:0,reservationCount:0,totalPayments:0,netBalance:e.balance||0},recentReservations:[],performanceStats:{totalTrips:0,avgEarningPerTrip:0,recentActivityCount:0,lastActivityDate:null}})),E(!0)}},O=async(e,t)=>{try{const a=await P(B(z(C,"reservations"),_("status","==","completed"),R("completedAt","desc"))),s=a.docs.map(e=>({id:e.id,...e.data()})).filter(a=>"regular"===t?a.assignedDriver===e||a.assignedDriverId===e||a.driverId===e:"manual"===a.assignedDriver&&a.manualDriverInfo&&a.manualDriverInfo.phone&&e.includes(a.manualDriverInfo.phone.replace(/[^0-9]/g,"")));return s.slice(0,10)}catch(a){return[]}},U=(e,t)=>{try{const s=e?.completedTrips||t?.reservationCount||0,r=s>0?(t?.totalEarnings||0)/s:0;let l=[];try{if(e?.transactions&&Array.isArray(e.transactions)){const t=new Date;t.setDate(t.getDate()-30),l=e.transactions.filter(e=>{try{return(e?.date?.seconds?new Date(1e3*e.date.seconds):new Date(e?.date||Date.now()))>=t}catch(a){return!1}})}}catch(a){l=[]}return{totalTrips:s,avgEarningPerTrip:Math.round(100*r)/100,recentActivityCount:l.length,lastActivityDate:e?.lastTransactionDate||null,cashTrips:e?.totalCashTrips||0,cardTrips:e?.totalCardTrips||0,totalCashCommission:e?.totalCashCommission||0,totalCardEarnings:e?.totalCardEarnings||0}}catch(a){return{totalTrips:0,avgEarningPerTrip:0,recentActivityCount:0,lastActivityDate:null,cashTrips:0,cardTrips:0,totalCashCommission:0,totalCardEarnings:0}}},q=[...l,...i].filter(e=>{if(!(e.displayName?.toLowerCase().includes(d.toLowerCase())||e.phone?.includes(d)||e.plateNumber?.toLowerCase().includes(d.toLowerCase())))return!1;const t=e.balance||0;switch(m){case"positive":return t>0;case"negative":return t<0;case"zero":return 0===t;default:return!0}}),Z={totalDrivers:q.length,totalDebt:q.filter(e=>(e.balance||0)>0).reduce((e,t)=>e+t.balance,0),totalCredit:Math.abs(q.filter(e=>(e.balance||0)<0).reduce((e,t)=>e+t.balance,0)),balancedDrivers:q.filter(e=>0===(e.balance||0)).length};return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(r,{className:"w-8 h-8 text-blue-600 animate-pulse mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"≈ûof√∂r verileri y√ºkleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"≈ûof√∂r √ñdeme Y√∂netimi"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"≈ûof√∂rlerin cari hesap durumu ve √∂deme/tahsilat i≈ülemleri"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Toplam ≈ûof√∂r"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Z.totalDrivers})]}),e.jsx(r,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white p-6 rounded-xl shadow-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Toplam Borcunuz"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:$(Z.totalDebt)}),e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"≈ûof√∂rlere √∂deyeceƒüiniz"})]}),e.jsx(y,{className:"w-8 h-8 text-red-600"})]})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white p-6 rounded-xl shadow-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Toplam Alacaƒüƒ±nƒ±z"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:$(Z.totalCredit)}),e.jsx("p",{className:"text-xs text-green-500 mt-1",children:"≈ûof√∂rlerden alacaƒüƒ±nƒ±z"})]}),e.jsx(s,{className:"w-8 h-8 text-green-600"})]})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white p-6 rounded-xl shadow-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Net Durum"}),e.jsx("p",{className:"text-2xl font-bold "+(Z.totalCredit-Z.totalDebt>=0?"text-blue-900":"text-red-900"),children:$(Z.totalCredit-Z.totalDebt)}),e.jsx("p",{className:"text-xs text-blue-500 mt-1",children:Z.totalCredit>Z.totalDebt?"Lehinizdeki fark":"Aleyinizdeki fark"})]}),e.jsx(g,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"≈ûof√∂r ara (isim, telefon, plaka)...",value:d,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"T√ºm ≈ûof√∂rler"}),e.jsx("option",{value:"positive",children:"Bor√ßlu ≈ûof√∂rler (Size)"}),e.jsx("option",{value:"negative",children:"Alacaklƒ± ≈ûof√∂rler (Sizden)"}),e.jsx("option",{value:"zero",children:"Dengeli Hesaplar"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-800",children:["≈ûof√∂r Cari Hesaplarƒ± (",q.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"≈ûof√∂r"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ƒ∞leti≈üim"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bakiye"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Durum"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ƒ∞≈ülemler"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:0===q.length?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:d||"all"!==m?"Filtrelere uygun ≈üof√∂r bulunamadƒ±":"Hen√ºz ≈üof√∂r kaydƒ± bulunmuyor"})}):q.map(t=>{const a=t.balance||0,s=K(a),r=s.icon;return e.jsxs(p.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center "+("regular"===t.type?"bg-blue-100":"bg-purple-100"),children:e.jsx("span",{className:"text-sm font-medium "+("regular"===t.type?"text-blue-700":"text-purple-700"),children:"regular"===t.type?`${t.firstName?.charAt(0)||""}${t.lastName?.charAt(0)||""}`:t.name?.charAt(0)||"M"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.displayName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("regular"===t.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"regular"===t.type?"Sistem ≈ûof√∂r√º":"Manuel ≈ûof√∂r"}),"regular"===t.type&&e.jsxs("span",{className:"text-xs text-gray-500",children:["%",t.commission," komisyon"]})]})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:["üì± ",t.phone||"Belirtilmemi≈ü"]}),t.plateNumber&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["üöó ",t.plateNumber]})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:`text-lg font-bold ${s.color}`,children:$(Math.abs(a))}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a>0?"Size bor√ßlu":a<0?"Sizden alacaklƒ±":"Hesap kapalƒ±"})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${s.bg} ${s.border} ${s.color} border`,children:[e.jsx(r,{className:"w-4 h-4 mr-2"}),s.text]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Y(t),className:"inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"Detay"]}),a>0&&e.jsxs("button",{onClick:()=>{h(t),G({type:"payment",amount:"",note:""}),D(!0)},className:"inline-flex items-center px-3 py-1 border border-green-300 text-sm font-medium rounded-md text-green-700 bg-green-50 hover:bg-green-100",children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),"√ñdeme"]}),a<0&&e.jsxs("button",{onClick:()=>{h(t),G({type:"collection",amount:"",note:""}),D(!0)},className:"inline-flex items-center px-3 py-1 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"Tahsilat"]})]})})]},`${t.type}_${t.id}`)})})]})})]}),e.jsx(w,{children:k&&u&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx(p.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"payment"===F.type?"üí≥ √ñdeme Yap":"üí∞ Tahsilat Yap"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["≈ûof√∂r: ",u.displayName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Mevcut Bakiye: ",e.jsxs("span",{className:K(u.balance||0).color,children:[$(Math.abs(u.balance||0)),(u.balance||0)>0?" (Size bor√ßlu)":(u.balance||0)<0?" (Sizden alacaklƒ±)":" (Dengeli)"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["payment"===F.type?"√ñdeme":"Tahsilat"," Tutarƒ± (‚Ç¨) *"]}),e.jsx("input",{type:"number",value:F.amount,onChange:e=>G(t=>({...t,amount:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"A√ßƒ±klama"}),e.jsx("input",{type:"text",value:F.note,onChange:e=>G(t=>({...t,note:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ƒ∞steƒüe baƒülƒ± a√ßƒ±klama"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{D(!1),h(null),G({type:"payment",amount:"",note:""})},className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"ƒ∞ptal"}),e.jsx("button",{onClick:async()=>{if(!u||!F.amount||parseFloat(F.amount)<=0)A.error("L√ºtfen ge√ßerli bir tutar girin");else try{const e=parseFloat(F.amount),t=u.balance||0;let a,s;"payment"===F.type?(a=t-e,s=L):(a=t+e,s=H),await s(u.id,u.type,u.displayName,e,F.note);const r="regular"===u.type?"users":"manual_drivers",l={balance:a,lastTransactionDate:new Date},i=u.transactions||[],d={id:Date.now().toString(),type:F.type,amount:e,note:F.note||("payment"===F.type?"√ñdeme":"Tahsilat")+" yapƒ±ldƒ±",date:new Date,balanceBefore:t,balanceAfter:a,processedBy:"admin_manual"};l.transactions=[...i,d],await M(I(C,r,u.id),l);("regular"===u.type?n:c)(e=>e.map(e=>e.id===u.id?{...e,balance:a,transactions:l.transactions}:e)),A.success(("payment"===F.type?"√ñdeme":"Tahsilat")+" ba≈üarƒ±yla kaydedildi"),D(!1),h(null),G({type:"payment",amount:"",note:""})}catch(e){A.error("ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu")}},disabled:!F.amount||parseFloat(F.amount)<=0,className:"flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("payment"===F.type?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:"payment"===F.type?"üí≥ √ñdeme Yap":"üí∞ Tahsilat Yap"})]})]})})})}),e.jsx(w,{children:T&&u&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx(p.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["üë§ ",u.displayName," - Detaylƒ± Rapor"]}),e.jsx("button",{onClick:()=>E(!1),className:"text-gray-400 hover:text-gray-600",children:"‚úï"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Toplam Kazan√ß"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:$(u.financialSummary?.totalEarnings||0)})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Tamamlanan Sefer"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:u.performanceStats?.totalTrips||0})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Ortalama Sefer Kazancƒ±"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:$(u.performanceStats?.avgEarningPerTrip||0)})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-orange-600 font-medium",children:"Mevcut Bakiye"}),e.jsxs("p",{className:"text-xl font-bold "+((u.balance||0)>=0?"text-orange-800":"text-red-600"),children:[$(Math.abs(u.balance||0)),e.jsx("span",{className:"text-sm font-normal ml-1",children:(u.balance||0)>0?"(Bor√ßlu)":(u.balance||0)<0?"(Alacaklƒ±)":"(Dengeli)"})]})]})]}),u.performanceStats&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"üìä Performans Analizi"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:u.performanceStats.cashTrips}),e.jsx("p",{className:"text-sm text-gray-600",children:"Nakit Sefer"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:u.performanceStats.cardTrips}),e.jsx("p",{className:"text-sm text-gray-600",children:"Kart/Havale Sefer"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:$(u.performanceStats.totalCashCommission)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Nakit Komisyon"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:$(u.performanceStats.totalCardEarnings)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Kart Kazan√ß"})]})]})]}),u.recentReservations&&u.recentReservations.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"üöó Son Seferler"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:u.recentReservations.map((t,a)=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:t.reservationNumber||t.reservationId}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.tripDetails?.pickupLocation||"Ba≈ülangƒ±√ß"," ‚Üí ",t.tripDetails?.dropoffLocation||"Varƒ±≈ü"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.customerInfo?.firstName," ",t.customerInfo?.lastName]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.completedAt?new Date(1e3*t.completedAt.seconds).toLocaleString("tr-TR"):"Tarih bilinmiyor"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-green-600",children:$(t.totalPrice||0)}),e.jsx("p",{className:"text-xs text-gray-500",children:"cash"===t.paymentMethod?"üí∞ Nakit":"üí≥ Kart"})]})]})},t.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"üíº Son Finansal ƒ∞≈ülemler"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:u.transactions?.slice(0,10).map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:"earning"===t.type?"üí∞ Rezervasyon Kazancƒ±":"commission_debt"===t.type?"üí∏ Komisyon Borcu":"payment"===t.type?"üí≥ √ñdeme Aldƒ±nƒ±z":"collection"===t.type?"üì• Tahsilat Yaptƒ±nƒ±z":"ÔøΩ Diƒüer ƒ∞≈ülem"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.note}),t.reservationId&&e.jsxs("p",{className:"text-xs text-blue-600",children:["#",t.reservationId]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.date.seconds?1e3*t.date.seconds:t.date).toLocaleString("tr-TR")})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold "+("earning"===t.type||"collection"===t.type?"text-green-600":"text-red-600"),children:["earning"===t.type||"collection"===t.type?"+":"-",$(t.amount)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Bakiye: ",$(Math.abs(t.balanceAfter||0))]})]})]},a))||e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Hen√ºz i≈ülem kaydƒ± bulunmuyor"})})]}),u.financialSummary&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-medium text-blue-800 mb-2",children:"üí° √ñzet Bilgiler"}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("p",{children:["‚Ä¢ Toplam ",u.performanceStats?.totalTrips||0," sefer tamamlandƒ±"]}),e.jsxs("p",{children:["‚Ä¢ Son i≈ülem: ",u.performanceStats?.lastActivityDate?new Date(1e3*u.performanceStats.lastActivityDate.seconds).toLocaleDateString("tr-TR"):"Hen√ºz i≈ülem yok"]}),e.jsxs("p",{children:["‚Ä¢ ≈ûof√∂r tipi: ","regular"===u.type?"Sisteme Kayƒ±tlƒ±":"Manuel"]})]})]})]})]})})})})]})},U=()=>{const[t,r]=S.useState([]),[l,n]=S.useState(!0),[i,c]=S.useState(!1),[d,o]=S.useState("all"),[m,x]=S.useState("all"),[u,h]=S.useState({type:"expense",amount:"",description:"",category:"",date:(new Date).toISOString().split("T")[0]});S.useEffect(()=>{const e=E(B(z(C,"financial_transactions"),R("createdAt","desc")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data(),date:e.data().createdAt?.toDate?.()||new Date}));r(t),n(!1)});return()=>e()},[]);const b=e=>{const t=parseFloat(e)||0;return new Intl.NumberFormat("tr-TR",{style:"currency",currency:"EUR"}).format(t)},f=()=>{let e=t;if("all"!==d&&(e=e.filter(e=>"income"===d?"credit"===e.type:"expense"!==d||"debit"===e.type)),"all"!==m){const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate());e=e.filter(e=>{const t=new Date(e.date);if("today"===m)return t>=a;if("week"===m){return t>=new Date(a.getTime()-6048e5)}if("month"===m){return t>=new Date(a.getTime()-2592e6)}return!0})}return e},j=(()=>{const e=f(),t=e.filter(e=>"credit"===e.type).reduce((e,t)=>e+(parseFloat(t.amount)||0),0),a=e.filter(e=>"debit"===e.type).reduce((e,t)=>e+(parseFloat(t.amount)||0),0);return{totalIncome:t,totalExpense:a,netBalance:t-a}})(),v=f();return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-green-50 border-2 border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b(j.totalIncome)}),e.jsx("div",{className:"text-sm text-green-700",children:"Toplam Gelir"})]})]})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-red-50 border-2 border-red-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b(j.totalExpense)}),e.jsx("div",{className:"text-sm text-red-700",children:"Toplam Gider"})]})]})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:(j.netBalance>=0?"bg-blue-50 border-blue-200 text-blue-600":"bg-orange-50 border-orange-200 text-orange-600")+" border-2 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(a,{className:"w-8 h-8 "+(j.netBalance>=0?"text-blue-600":"text-orange-600")}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold "+(j.netBalance>=0?"text-blue-600":"text-orange-600"),children:b(j.netBalance)}),e.jsx("div",{className:"text-sm "+(j.netBalance>=0?"text-blue-700":"text-orange-700"),children:"Net Bakiye"})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl p-6 border",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("select",{value:d,onChange:e=>o(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"T√ºm ƒ∞≈ülemler"}),e.jsx("option",{value:"income",children:"Sadece Gelirler"}),e.jsx("option",{value:"expense",children:"Sadece Giderler"})]}),e.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"T√ºm Zamanlar"}),e.jsx("option",{value:"today",children:"Bug√ºn"}),e.jsx("option",{value:"week",children:"Son 7 G√ºn"}),e.jsx("option",{value:"month",children:"Son 30 G√ºn"})]})]}),e.jsxs("button",{onClick:()=>c(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(N,{className:"w-4 h-4"}),"Yeni ƒ∞≈ülem Ekle"]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-gray-600"}),"Gelir-Gider ƒ∞≈ülemleri (",v.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tarih"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tip"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ßƒ±klama"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kategori"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tutar"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ƒ∞≈ülemler"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[v.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.date.toLocaleDateString("tr-TR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("credit"===t.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"credit"===t.type?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-3 h-3 mr-1"}),"Gelir"]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Gider"]})})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.category||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("span",{className:"credit"===t.type?"text-green-600":"text-red-600",children:["credit"===t.type?"+":"-",b(t.amount)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:"manuel_entry"===t.source&&e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Bu i≈ülemi silmek istediƒüinizden emin misiniz?"))try{await $(I(C,"financial_transactions",e)),alert("ƒ∞≈ülem ba≈üarƒ±yla silindi!")}catch(t){alert("ƒ∞≈ülem silinirken hata olu≈ütu!")}})(t.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Sil",children:e.jsx(T,{className:"w-4 h-4"})})})]},t.id)),0===v.length&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"Hen√ºz i≈ülem kaydƒ± bulunmuyor"}),e.jsx("p",{className:"text-sm",children:"Yeni i≈ülem ekleyerek ba≈ülayabilirsiniz"})]})})]})]})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Yeni ƒ∞≈ülem Ekle"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),u.amount&&u.description)try{await G(z(C,"financial_transactions"),{type:"income"===u.type?"credit":"debit",amount:parseFloat(u.amount),description:u.description,category:u.category,date:u.date,source:"manuel_entry",createdAt:K(),createdBy:"admin"}),h({type:"expense",amount:"",description:"",category:"",date:(new Date).toISOString().split("T")[0]}),c(!1),alert("ƒ∞≈ülem ba≈üarƒ±yla eklendi!")}catch(t){alert("ƒ∞≈ülem eklenirken hata olu≈ütu!")}else alert("L√ºtfen t√ºm alanlarƒ± doldurun!")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ƒ∞≈ülem Tipi"}),e.jsxs("select",{value:u.type,onChange:e=>h({...u,type:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"expense",children:"Gider"}),e.jsx("option",{value:"income",children:"Gelir"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tutar (EUR)"}),e.jsx("input",{type:"number",step:"0.01",value:u.amount,onChange:e=>h({...u,amount:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"A√ßƒ±klama"}),e.jsx("input",{type:"text",value:u.description,onChange:e=>h({...u,description:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ƒ∞≈ülem a√ßƒ±klamasƒ±...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori"}),e.jsxs("select",{value:u.category,onChange:e=>h({...u,category:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Kategori Se√ßin"}),("expense"===u.type?["≈ûof√∂r √ñdemesi","Yakƒ±t","Ara√ß Bakƒ±m","Sigorta","Kira","Personel Maa≈üƒ±","Pazarlama","Ofis Giderleri","Vergi","Diƒüer"]:["Rezervasyon Geliri","≈ûof√∂rden Tahsilat","Ek Servis Geliri","Diƒüer"]).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tarih"}),e.jsx("input",{type:"date",value:u.date,onChange:e=>h({...u,date:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"ƒ∞ptal"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Ekle"})]})]})]})})]})},q=()=>{const[t,a]=S.useState("dashboard"),s=[{id:"dashboard",label:"üìä Finansal Dashboard",icon:m,component:Y,description:"G√ºncel finansal durum, gelir-gider analizi ve trend grafikler"},{id:"driver-payments",label:"üí≥ ≈ûof√∂r Cari Hesaplarƒ±",icon:r,component:O,description:"≈ûof√∂rlerden alacak/verecek durumu ve √∂deme/tahsilat i≈ülemleri"},{id:"income-expense",label:"üí∞ Gelir-Gider Y√∂netimi",icon:y,component:U,description:"Gelir-gider tablosu, manuel i≈ülem ekleme ve finansal kayƒ±t takibi"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"flex flex-wrap border-b border-gray-200",children:s.map(s=>e.jsxs("button",{onClick:()=>a(s.id),className:`\n                flex items-center gap-2 px-4 py-3 transition-all duration-200 font-medium text-sm\n                ${t===s.id?"bg-blue-50 text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-800"}\n              `,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id))}),e.jsx("div",{className:"p-6",children:e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},children:(()=>{const a=s.find(e=>e.id===t),r=a?.component;return r?e.jsx(r,{}):null})()},t)})]})})};export{q as default};
