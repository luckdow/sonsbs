import{j as e,x as s,c as t,u as a,am as l,r,af as i,D as c,aw as n,z as d,m,U as o,P as x,d as h}from"./chunk-Do_hQOja.js";import{r as u}from"./chunk-rj-8a6OE.js";import{c as g}from"./index-B4sOzZkQ.js";import"./chunk-Bkkzv6j4.js";import"./chunk-uNZoKFSG.js";import"./chunk-BXGe81IW.js";import"./chunk-SPeBi8oJ.js";const p=()=>{const{state:p,user:j,updateReservation:N,showNotification:f}=g(),{reservations:v,drivers:y}=p,[b,w]=u.useState(null),[D,C]=u.useState([]),[k,S]=u.useState("all"),[L,I]=u.useState(""),[T,z]=u.useState("");u.useEffect(()=>{const e=y.find(e=>e.email===j?.email);if(w(e),e){const s=v.filter(s=>s.driverId===e.id);C(s)}},[y,v,j]);const $=[{value:"assigned",label:"Atandı",color:"status-assigned"},{value:"in-progress",label:"Devam Ediyor",color:"status-progress"},{value:"completed",label:"Tamamlandı",color:"status-completed"},{value:"cancelled",label:"İptal Edildi",color:"status-cancelled"}],R=e=>$.find(s=>s.value===e)||$[0],E=async(e,s)=>{try{await N(e,{status:s}),f("Sefer durumu güncellendi","success")}catch(t){f("Durum güncellenirken bir hata oluştu","error")}},P=D.filter(e=>{const s=e.reservationId?.toLowerCase().includes(T.toLowerCase())||e.customerInfo?.firstName?.toLowerCase().includes(T.toLowerCase())||e.customerInfo?.lastName?.toLowerCase().includes(T.toLowerCase())||e.tripDetails?.from?.toLowerCase().includes(T.toLowerCase())||e.tripDetails?.to?.toLowerCase().includes(T.toLowerCase()),t="all"===k||e.status===k,a=!L||e.tripDetails?.date&&new Date(e.tripDetails.date).toDateString()===new Date(L).toDateString();return s&&t&&a}),A={total:D.length,assigned:D.filter(e=>"assigned"===e.status).length,inProgress:D.filter(e=>"in-progress"===e.status).length,completed:D.filter(e=>"completed"===e.status).length,cancelled:D.filter(e=>"cancelled"===e.status).length,totalEarnings:D.filter(e=>"completed"===e.status).reduce((e,s)=>e+(s.totalPrice||0)*((b?.commission||10)/100),0)},B=(e,s)=>{if(!e)return"Tarih belirtilmemiş";const t=new Date(e).toLocaleDateString("tr-TR");return s?`${t} - ${s}`:t};return b?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Seferlerim"}),e.jsx("p",{className:"text-gray-600",children:"Atanmış ve tamamlanmış seferlerinizi görüntüleyin"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(t,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.total}),e.jsx("p",{className:"text-sm text-gray-600",children:"Toplam"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(a,{className:"w-8 h-8 text-orange-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.assigned}),e.jsx("p",{className:"text-sm text-gray-600",children:"Atandı"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(l,{className:"w-8 h-8 text-purple-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.inProgress}),e.jsx("p",{className:"text-sm text-gray-600",children:"Devam Ediyor"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(r,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.completed}),e.jsx("p",{className:"text-sm text-gray-600",children:"Tamamlandı"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(i,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.cancelled}),e.jsx("p",{className:"text-sm text-gray-600",children:"İptal"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(c,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["€",A.totalEarnings.toLocaleString("tr-TR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Kazanç"})]})})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Rezervasyon ID veya müşteri adı ile ara...",className:"input pl-10",value:T,onChange:e=>z(e.target.value)})]}),e.jsx("div",{children:e.jsxs("select",{className:"input",value:k,onChange:e=>S(e.target.value),children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),$.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})}),e.jsx("div",{children:e.jsx("input",{type:"date",className:"input",value:L,onChange:e=>I(e.target.value),placeholder:"Tarih filtrele"})})]})})}),0===P.length?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center py-12",children:[e.jsx(d,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:T||"all"!==k||L?"Sefer bulunamadı":"Henüz sefer yok"}),e.jsx("p",{className:"text-gray-500",children:T||"all"!==k||L?"Arama kriterlerinize uygun sefer bulunamadı":"Size atanmış seferler burada görünecektir"})]})}):e.jsx("div",{className:"space-y-4",children:P.sort((e,s)=>{const t=new Date(`${e.tripDetails?.date}T${e.tripDetails?.time||"00:00"}`);return new Date(`${s.tripDetails?.date}T${s.tripDetails?.time||"00:00"}`)-t}).map((s,t)=>{return e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"card hover:shadow-lg transition-shadow",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.reservationId||`RES-${s.id?.slice(-6)}`}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${R(s.status).color}`,children:R(s.status).label})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["€",s.totalPrice?.toLocaleString("tr-TR")||"0"]}),e.jsxs("p",{className:"text-sm text-green-600 font-medium",children:["Kazanç: €",(l=s.totalPrice,b&&l?l*((b.commission||10)/100):0).toLocaleString("tr-TR")]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"Müşteri"]}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.customerInfo?.firstName," ",s.customerInfo?.lastName]}),s.customerInfo?.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(x,{className:"w-3 h-3 mr-1"}),s.customerInfo.phone]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(h,{className:"w-4 h-4 mr-1"}),"Güzergah"]}),e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("span",{className:"block truncate",children:s.tripDetails?.from||"Bilinmiyor"}),e.jsx("span",{className:"text-gray-500",children:"→"}),e.jsx("span",{className:"block truncate",children:s.tripDetails?.to||"Bilinmiyor"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(a,{className:"w-4 h-4 mr-1"}),"Tarih & Saat"]}),e.jsx("p",{className:"text-sm text-gray-900",children:B(s.tripDetails?.date,s.tripDetails?.time)}),s.tripDetails?.distance&&e.jsxs("p",{className:"text-sm text-gray-500",children:[s.tripDetails.distance," km"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"Yolcular"]}),e.jsxs("p",{className:"text-sm text-gray-900",children:[s.passengerCount||1," Yetişkin",s.childCount>0&&`, ${s.childCount} Çocuk`]}),s.luggageCount>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:[s.luggageCount," Bagaj"]})]})]}),s.specialRequests&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Özel İstekler:"})," ",s.specialRequests]})})]}),e.jsxs("div",{className:"flex flex-col space-y-2 lg:ml-4",children:["assigned"===s.status&&e.jsx("button",{onClick:()=>E(s.id,"in-progress"),className:"btn btn-primary",children:"Sefere Başla"}),"in-progress"===s.status&&e.jsx("button",{onClick:()=>E(s.id,"completed"),className:"btn btn-success",children:"Seferi Tamamla"}),e.jsxs("div",{className:"flex space-x-2",children:[s.customerInfo?.phone&&e.jsx("a",{href:`tel:${s.customerInfo.phone}`,className:"btn btn-sm btn-outline",title:"Müşteriyi Ara",children:e.jsx(x,{className:"w-4 h-4"})}),s.tripDetails?.from&&s.tripDetails?.to&&e.jsx("a",{href:`https://www.google.com/maps/dir/${encodeURIComponent(s.tripDetails.from)}/${encodeURIComponent(s.tripDetails.to)}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline",title:"Haritada Aç",children:e.jsx(h,{className:"w-4 h-4"})}),("assigned"===s.status||"in-progress"===s.status)&&e.jsx("button",{onClick:()=>{window.confirm("Bu seferi iptal etmek istediğinizden emin misiniz?")&&E(s.id,"cancelled")},className:"btn btn-sm btn-outline text-red-600 border-red-200 hover:bg-red-50",title:"Seferi İptal Et",children:e.jsx(i,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${R(s.status).color}`,children:R(s.status).label})})]})]})})},s.id);var l})})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(s,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Şoför Profili Bulunamadı"}),e.jsx("p",{className:"text-gray-500",children:"Lütfen yöneticinizle iletişime geçin."})]})})};export{p as default};
