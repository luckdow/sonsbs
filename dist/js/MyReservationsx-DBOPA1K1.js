import{j as e,g as s,L as a,aw as r,c as t,m as l,d as i,r as n,U as o,P as d,a as c,a7 as m,ax as x,X as u,am as g,x as p,au as h,av as f}from"./chunk-Do_hQOja.js";import{a as b,r as N}from"./chunk-rj-8a6OE.js";import{u as j,d as y,V as v,U as w}from"./index-B4sOzZkQ.js";import{A as k,B as D,K as I,M as C,u as L,n as S}from"./chunk-SPeBi8oJ.js";import{Q as T}from"./chunk-DbXQ5VJ5.js";import"./chunk-Bkkzv6j4.js";import"./chunk-uNZoKFSG.js";import"./chunk-BXGe81IW.js";const z=()=>{const{user:z,userProfile:R,signOut:B}=j(),E=b(),[A,$]=N.useState([]),[O,P]=N.useState([]),[G,M]=N.useState([]),[U,H]=N.useState([]),[K,V]=N.useState(""),[F,Q]=N.useState("all"),[Y,_]=N.useState(null),[q,J]=N.useState(""),[W,X]=N.useState(!1),[Z,ee]=N.useState(null),[se,ae]=N.useState(!1),[re,te]=N.useState({}),[le,ie]=N.useState(!0),ne=e=>A.find(s=>s.id===e)||{firstName:"Bilinmiyor",lastName:"",phone:"Bilinmiyor"},oe=e=>{const s=new Date(e.tripDetails?.date||e.date),a=e.tripDetails?.time||e.time;if(!s||!a)return!1;const[r,t]=a.split(":");s.setHours(parseInt(r),parseInt(t),0,0);const l=new Date;return(s.getTime()-l.getTime())/36e5>12&&["pending","confirmed","PENDING","CONFIRMED"].includes(e.status)},de=e=>{const s={firstName:e.customerInfo?.firstName||e.personalInfo?.firstName||"",lastName:e.customerInfo?.lastName||e.personalInfo?.lastName||"",phone:e.customerInfo?.phone||e.personalInfo?.phone||"",email:e.customerInfo?.email||e.personalInfo?.email||"",flightNumber:e.customerInfo?.flightNumber||e.personalInfo?.flightNumber||"",flightTime:e.customerInfo?.flightTime||e.personalInfo?.flightTime||"",pickupLocation:je(e.tripDetails?.pickupLocation||e.pickupLocation),dropoffLocation:je(e.tripDetails?.dropoffLocation||e.dropoffLocation),date:e.tripDetails?.date||e.date||"",time:e.tripDetails?.time||e.time||"",passengerCount:e.tripDetails?.passengerCount||e.passengerCount||1};te(s),ee(e),ae(!0)},ce=async e=>{if(window.confirm(`Bu rezervasyonu iptal etmek istediğinizden emin misiniz?\n\nRezervasyon: ${e.reservationCode||e.reservationId}\nTarih: ${e.tripDetails?.date||e.date} ${e.tripDetails?.time||e.time}`))try{const s={status:"cancelled",cancelledAt:(new Date).toISOString(),cancelledBy:z.email,cancellationReason:"Müşteri tarafından iptal edildi",updatedAt:(new Date).toISOString()};await L(S(y,"reservations",e.id),s),v.success("Rezervasyon başarıyla iptal edildi. Admin panelinde görüntülenecek."),X(!1)}catch(s){v.error("Rezervasyon iptal edilirken hata oluştu: "+s.message)}};N.useEffect(()=>{if(!z?.email)return void ie(!1);const e=k(D(y,"reservations")),s=I(e,e=>{const s=e.docs.map(e=>({id:e.id,...e.data()})),a=z.email.toLowerCase(),r=new Set,t=s.filter(e=>{const s=e.personalInfo?.email?.toLowerCase(),t=e.customerInfo?.email?.toLowerCase(),l=s===a||t===a,i=e.reservationCode||e.reservationId||e.id;return!(!l||r.has(i))&&(r.add(i),!0)});M(t)},e=>{}),a=k(D(y,"users"),C("role","==",w.DRIVER)),r=I(a,e=>{const s=e.docs.map(e=>({id:e.id,...e.data(),firstName:e.data().firstName||"",lastName:e.data().lastName||"",phone:e.data().phone||""}));$(s)},e=>{}),t=k(D(y,"vehicles"),C("status","==","active")),l=I(t,e=>{const s=e.docs.map(e=>({id:e.id,...e.data()}));P(s),ie(!1)},e=>{ie(!1)});return()=>{s(),r(),l()}},[z]),N.useEffect(()=>{let e=G;K&&(e=e.filter(e=>e?.id?.toLowerCase().includes(K.toLowerCase())||e?.reservationCode?.toLowerCase().includes(K.toLowerCase())||e?.reservationId?.toLowerCase().includes(K.toLowerCase())||je(fe(e))?.toLowerCase().includes(K.toLowerCase())||je(be(e))?.toLowerCase().includes(K.toLowerCase())||Ne(e)?.toLowerCase().includes(K.toLowerCase()))),"all"!==F&&(e=e.filter(e=>e?.status===F)),e.sort((e,s)=>{const a=new Date(e?.createdAt||e?.date||0);return new Date(s?.createdAt||s?.date||0)-a}),H(e)},[G,K,F]);const me=[{value:"pending",label:"Bekliyor",color:"bg-yellow-100 text-yellow-800"},{value:"confirmed",label:"Onaylandı",color:"bg-blue-100 text-blue-800"},{value:"assigned",label:"Şoför Atandı",color:"bg-green-100 text-green-800"},{value:"in_progress",label:"Devam Ediyor",color:"bg-purple-100 text-purple-800"},{value:"completed",label:"Tamamlandı",color:"bg-green-100 text-green-800"},{value:"cancelled",label:"İptal Edildi",color:"bg-red-100 text-red-800"},{value:"PENDING",label:"Bekliyor",color:"bg-yellow-100 text-yellow-800"},{value:"CONFIRMED",label:"Onaylandı",color:"bg-blue-100 text-blue-800"},{value:"ASSIGNED",label:"Şoför Atandı",color:"bg-green-100 text-green-800"},{value:"IN_PROGRESS",label:"Devam Ediyor",color:"bg-purple-100 text-purple-800"},{value:"COMPLETED",label:"Tamamlandı",color:"bg-green-100 text-green-800"},{value:"CANCELLED",label:"İptal Edildi",color:"bg-red-100 text-red-800"}],xe=e=>me.find(s=>s.value===e)||me[0],ue=e=>{if(!e)return"Henüz atanmadı";const s=A.find(s=>s.id===e);return s?`${s.firstName} ${s.lastName}`:"Bilinmeyen Şoför"},ge=e=>{if(!e)return null;const s=A.find(s=>s.id===e);return s?.phone},pe=e=>{if(!e)return{brand:"Henüz atanmadı",model:"",plateNumber:"",full:"Henüz atanmadı"};const s=O.find(s=>s.id===e);return s?{brand:s.brand||"Bilinmeyen",model:s.model||"",plateNumber:s.plateNumber||"Bilinmeyen",full:`${s.brand} ${s.model} (${s.plateNumber})`}:{brand:"Bilinmeyen araç",model:"",plateNumber:"",full:"Bilinmeyen araç"}},he=e=>{const s=e?.tripDetails?.date||e?.date,a=e?.tripDetails?.time||e?.time;if(!s)return"Tarih belirtilmemiş";const r=new Date(s).toLocaleDateString("tr-TR");return a?`${r} - ${a}`:r},fe=e=>je(e?.tripDetails?.pickupLocation||e?.pickupLocation),be=e=>je(e?.tripDetails?.dropoffLocation||e?.dropoffLocation),Ne=e=>`${e.customerInfo?.firstName||e.personalInfo?.firstName||""} ${e.customerInfo?.lastName||e.personalInfo?.lastName||""}`.trim()||"İsimsiz",je=e=>e?"string"==typeof e?e:"object"==typeof e?e.address?String(e.address):e.name?String(e.name):e.formatted_address?String(e.formatted_address):e.description?String(e.description):"Lokasyon bilgisi mevcut":String(e):"Bilinmiyor";return z?le?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Rezervasyonlar yükleniyor..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Rezervasyonlarım"}),e.jsxs("p",{className:"text-gray-600",children:["Hoş geldiniz, ",R?.firstName||z.email]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>E("/profil"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{children:"Profil"})]}),e.jsxs("button",{onClick:async()=>{try{await B(),E("/")}catch(e){}},className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:"Çıkış"})]})]})]})})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:G.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Toplam Rezervasyon"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:G.filter(e=>"pending"===e.status||"PENDING"===e.status).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Bekleyen"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:G.filter(e=>"completed"===e.status||"COMPLETED"===e.status).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Tamamlandı"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:G.filter(e=>e.assignedDriver&&""!==e.assignedDriver).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Şoför Atandı"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Rezervasyon ara...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:K,onChange:e=>V(e.target.value)})]}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:F,onChange:e=>Q(e.target.value),children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),me.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),0===U.length?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[e.jsx(t,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:K||"all"!==F?"Rezervasyon bulunamadı":"Henüz rezervasyon yok"}),e.jsx("p",{className:"text-gray-500 mb-6",children:K||"all"!==F?"Arama kriterlerinize uygun rezervasyon bulunamadı":"İlk rezervasyonunuzu yapmaya başlayın"}),!K&&"all"===F&&e.jsx("button",{onClick:()=>E("/"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Rezervasyon Yap"})]}):e.jsx("div",{className:"space-y-4",children:U.map((s,a)=>e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["#",s?.reservationCode||s?.reservationId||s?.id?.slice(-8)||"Rezervasyon"]}),e.jsx("span",{className:`inline-block px-2 py-1 text-xs font-medium rounded-full ${xe(s?.status).color}`,children:xe(s?.status).label})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["€",Number(s?.totalPrice||0).toLocaleString("tr-TR")]}),e.jsx("p",{className:"text-sm text-gray-500",children:he(s)})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[e.jsx(i,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"Güzergah"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("p",{className:"text-sm text-gray-900",children:je(fe(s))})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full mr-2"}),e.jsx("p",{className:"text-sm text-gray-900",children:je(be(s))})]})]})]}),s?.assignedDriver&&"manual"!==s.assignedDriver&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 mb-4 border border-green-200",children:[e.jsxs("h4",{className:"font-medium text-green-900 text-sm mb-3 flex items-center",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"Şoför Atandı"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"Şoför"})]}),e.jsx("p",{className:"font-semibold text-green-900 mb-1",children:ue(s.assignedDriver)}),ge(s.assignedDriver)&&e.jsxs("a",{href:`tel:${ge(s.assignedDriver)}`,className:"inline-flex items-center text-sm text-green-600 hover:text-green-800 bg-green-100 hover:bg-green-200 px-2 py-1 rounded transition-colors",children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),ge(s.assignedDriver)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(c,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"Araç"})]}),e.jsx("p",{className:"font-semibold text-green-900 mb-1",children:pe(s.assignedVehicle||s.vehicleId).full}),pe(s.assignedVehicle||s.vehicleId).plateNumber&&"Bilinmeyen"!==pe(s.assignedVehicle||s.vehicleId).plateNumber&&e.jsx("span",{className:"inline-block text-xs bg-green-200 text-green-800 px-2 py-1 rounded font-mono",children:pe(s.assignedVehicle||s.vehicleId).plateNumber})]})]})]}),"manual"===s?.assignedDriver&&s.manualDriverInfo&&e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 mb-4 border border-purple-200",children:[e.jsxs("h4",{className:"font-medium text-purple-900 text-sm mb-3 flex items-center",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"Şoför Atandı"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-purple-700 mb-1",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"Şoför"})]}),e.jsx("p",{className:"font-semibold text-purple-900 mb-1",children:s.manualDriverInfo.name}),e.jsxs("a",{href:`tel:${s.manualDriverInfo.phone}`,className:"inline-flex items-center text-sm text-purple-600 hover:text-purple-800 bg-purple-100 hover:bg-purple-200 px-2 py-1 rounded transition-colors",children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),s.manualDriverInfo.phone]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>{_(s),X(!0);const e=s?.reservationCode||s?.reservationId||s?.id,a=s?.customerInfo?.phone||(e=>e.customerInfo?.phone||e.personalInfo?.phone||"")(s);e&&a&&(async(e,s)=>{try{if(!s)return;const a=`SBS Transfer - Rezervasyon: ${e} - Tel: ${s}`,r=await T.toDataURL(a,{width:200,margin:2,color:{dark:"#1f2937",light:"#ffffff"}});J(r)}catch(a){}})(e,a)},className:"flex items-center px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"Detaylar"]}),oe(s)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>de(s),className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"Düzenle"]}),e.jsxs("button",{onClick:()=>ce(s),className:"flex items-center px-3 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition-colors",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),"İptal Et"]})]}),ge(s.assignedDriver||s.driverId)&&e.jsxs("a",{href:`tel:${ge(s.assignedDriver||s.driverId)}`,className:"flex items-center px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-colors",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"Şoförü Ara"]}),s?.pickupLocation&&s?.dropoffLocation&&e.jsxs("a",{href:`https://www.google.com/maps/dir/${encodeURIComponent(je(s?.pickupLocation))}/${encodeURIComponent(je(s?.dropoffLocation))}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"Harita"]})]}),!oe(s)&&["pending","confirmed","PENDING","CONFIRMED"].includes(s.status)&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-sm text-yellow-800",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Rezervasyon tarihine 12 saatten az kaldığı için düzenleme/iptal yapılamaz. Değişiklik için lütfen iletişime geçin: +90 532 574 26 82"})]})})]})},s?.id||a))}),se&&Z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(l.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b p-4 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Rezervasyon Düzenle - #",Z.reservationCode||Z.reservationId]}),e.jsx("button",{onClick:()=>ae(!1),className:"text-gray-400 hover:text-gray-600 text-xl",children:"×"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(o,{className:"w-4 h-4 mr-2 text-blue-600"}),"Müşteri Bilgileri"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ad"}),e.jsx("input",{type:"text",value:re.firstName||"",onChange:e=>te({...re,firstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ad"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Soyad"}),e.jsx("input",{type:"text",value:re.lastName||"",onChange:e=>te({...re,lastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Soyad"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefon"}),e.jsx("input",{type:"tel",value:re.phone||"",onChange:e=>te({...re,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Telefon numarası"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-posta"}),e.jsx("input",{type:"email",value:re.email||"",onChange:e=>te({...re,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"E-posta adresi"})]})]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Uçuş Bilgileri (Opsiyonel)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Uçuş Numarası"}),e.jsx("input",{type:"text",value:re.flightNumber||"",onChange:e=>te({...re,flightNumber:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Örn: TK123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Uçuş Saati"}),e.jsx("input",{type:"time",value:re.flightTime||"",onChange:e=>te({...re,flightTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(i,{className:"w-4 h-4 mr-2 text-green-600"}),"Seyahat Bilgileri"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nereden"}),e.jsx("input",{type:"text",value:re.pickupLocation||"",onChange:e=>te({...re,pickupLocation:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Kalkış noktası"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nereye"}),e.jsx("input",{type:"text",value:re.dropoffLocation||"",onChange:e=>te({...re,dropoffLocation:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Varış noktası"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tarih"}),e.jsx("input",{type:"date",value:re.date||"",onChange:e=>te({...re,date:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Saat"}),e.jsx("input",{type:"time",value:re.time||"",onChange:e=>te({...re,time:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Yolcu Sayısı"}),e.jsx("select",{value:re.passengerCount||1,onChange:e=>te({...re,passengerCount:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[1,2,3,4,5,6,7,8].map(s=>e.jsxs("option",{value:s,children:[s," Kişi"]},s))})]})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center text-sm text-yellow-800",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Değişiklikler admin panelinde görüntülenecek ve manuel onay gerektirebilir."})]})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t p-4 flex space-x-3",children:[e.jsxs("button",{onClick:async()=>{if(Z)try{const e={customerInfo:{firstName:re.firstName,lastName:re.lastName,phone:re.phone,email:re.email,flightNumber:re.flightNumber,flightTime:re.flightTime},personalInfo:{firstName:re.firstName,lastName:re.lastName,phone:re.phone,email:re.email,flightNumber:re.flightNumber,flightTime:re.flightTime},tripDetails:{...Z.tripDetails,pickupLocation:re.pickupLocation,dropoffLocation:re.dropoffLocation,date:re.date,time:re.time,passengerCount:parseInt(re.passengerCount)},pickupLocation:re.pickupLocation,dropoffLocation:re.dropoffLocation,date:re.date,time:re.time,passengerCount:parseInt(re.passengerCount),lastEditedAt:(new Date).toISOString(),editedBy:z.email,editHistory:[...Z.editHistory||[],{editedAt:(new Date).toISOString(),editedBy:z.email,changes:"Müşteri bilgileri ve seyahat detayları güncellendi"}],updatedAt:(new Date).toISOString()};await L(S(y,"reservations",Z.id),e),v.success("Rezervasyon başarıyla güncellendi. Değişiklikler admin panelinde görüntülenecek."),ae(!1),ee(null),te({})}catch(e){v.error("Rezervasyon güncellenirken hata oluştu: "+e.message)}},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(n,{className:"w-4 h-4"}),"Değişiklikleri Kaydet"]}),e.jsx("button",{onClick:()=>ae(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"İptal"})]})]})}),W&&Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(l.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Rezervasyon Detayları"}),e.jsx("button",{onClick:()=>X(!1),className:"text-gray-400 hover:text-gray-600 text-xl",children:"×"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200 mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(o,{className:"w-4 h-4 mr-2 text-blue-600"}),"Müşteri Bilgileri"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Ad Soyad"}),e.jsxs("p",{className:"font-medium",children:[Y.customerInfo?.firstName||Y.personalInfo?.firstName||""," "," ",Y.customerInfo?.lastName||Y.personalInfo?.lastName||""]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Telefon"}),e.jsx("p",{className:"font-medium",children:Y.customerInfo?.phone||Y.personalInfo?.phone||"Belirtilmedi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"E-posta"}),e.jsx("p",{className:"font-medium",children:Y.customerInfo?.email||Y.personalInfo?.email||"Belirtilmedi"})]}),(Y.customerInfo?.flightNumber||Y.personalInfo?.flightNumber)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Uçuş Numarası"}),e.jsx("p",{className:"font-medium",children:Y.customerInfo?.flightNumber||Y.personalInfo?.flightNumber})]}),(Y.customerInfo?.flightTime||Y.personalInfo?.flightTime)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Uçuş Saati"}),e.jsx("p",{className:"font-medium",children:Y.customerInfo?.flightTime||Y.personalInfo?.flightTime})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Rezervasyon Kodu"}),e.jsxs("p",{className:"font-medium",children:["#",Y.reservationCode||Y.reservationId||Y.id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Durum"}),e.jsx("span",{className:`inline-block px-2 py-1 text-xs font-medium rounded-full ml-2 ${xe(Y.status).color}`,children:xe(Y.status).label})]}),Y.assignedDriver&&"manual"!==Y.assignedDriver&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(o,{className:"w-4 h-4 mr-2 text-green-600"}),"Atanan Şoför"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Şoför Adı"}),e.jsxs("p",{className:"font-medium",children:[ne(Y.assignedDriver).firstName," ",ne(Y.assignedDriver).lastName]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Telefon"}),e.jsx("p",{className:"font-medium",children:ne(Y.assignedDriver).phone||"Belirtilmedi"})]})]})]}),"manual"===Y.assignedDriver&&Y.manualDriverInfo&&e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(o,{className:"w-4 h-4 mr-2 text-purple-600"}),"Atanan Şoför"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Şoför Adı"}),e.jsx("p",{className:"font-medium",children:Y.manualDriverInfo.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Telefon"}),e.jsx("p",{className:"font-medium",children:Y.manualDriverInfo.phone})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Tarih & Saat"}),e.jsxs("p",{className:"font-medium",children:[Y.tripDetails?.date||Y.date||"Belirtilmedi"," - ",Y.tripDetails?.time||Y.time||"Belirtilmedi"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Nereden"}),e.jsx("p",{className:"font-medium",children:je(Y.tripDetails?.pickupLocation||Y.pickupLocation)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Nereye"}),e.jsx("p",{className:"font-medium",children:je(Y.tripDetails?.dropoffLocation||Y.dropoffLocation)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Seçilen Araç"}),e.jsx("p",{className:"font-medium",children:Y.selectedVehicle?.name||Y.selectedVehicle?.type||Y.vehicleType||Y.vehicleInfo?.name||"Belirlenmedi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Transfer Tipi"}),e.jsx("p",{className:"font-medium",children:"round-trip"===Y.transferType||Y.isRoundTrip?"Gidiş-Dönüş":"Tek Yön"})]}),("round-trip"===Y.transferType||Y.isRoundTrip)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Dönüş Tarihi"}),e.jsx("p",{className:"font-medium",children:Y.returnDate?new Date(Y.returnDate).toLocaleDateString("tr-TR"):"Belirtilmemiş"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Dönüş Saati"}),e.jsx("p",{className:"font-medium",children:Y.returnTime||"Belirtilmemiş"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Toplam Ücret"}),e.jsxs("p",{className:"font-medium text-blue-600",children:["€",Number(Y.totalPrice||0).toLocaleString("tr-TR")]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-5 h-5 text-purple-600"}),e.jsx("label",{className:"text-sm text-gray-600 font-medium",children:"QR Kod"})]})}),q?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-white p-3 rounded-lg border-2 border-purple-200 inline-block mb-3",children:e.jsx("img",{src:q,alt:"QR Code",className:"w-32 h-32 mx-auto"})}),e.jsxs("button",{onClick:()=>{if(q&&Y){const e=document.createElement("a");e.download=`SBS-Transfer-${Y?.reservationCode||Y?.reservationId}.png`,e.href=q,e.click()}},className:"w-full px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg transition-all duration-300 text-sm flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"QR Kodunu İndir"]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-32 h-32 mx-auto flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsx("div",{className:"w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"})}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"QR kod oluşturuluyor..."})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t p-4 space-y-3",children:[oe(Y)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-center text-sm text-green-800",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Rezervasyon tarihine 12+ saat var. Düzenleme/iptal yapabilirsiniz."})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>de(Y),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),"Düzenle"]}),e.jsxs("button",{onClick:()=>ce(Y),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"İptal Et"]})]})]}):["pending","confirmed","PENDING","CONFIRMED"].includes(Y.status)&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-center text-sm text-yellow-800",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Rezervasyon tarihine 12 saatten az kaldı. Değişiklik için lütfen +90 532 574 26 82 numaralı telefonu arayın."})]})}),e.jsx("button",{onClick:()=>X(!1),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Kapat"})]})]})})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Giriş Yapmanız Gerekiyor"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Rezervasyonlarınızı görmek için lütfen giriş yapın."}),e.jsx("button",{onClick:()=>E("/giriş"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Giriş Yap"})]})})};export{z as default};
