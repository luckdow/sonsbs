import{m as e,n as t,s as a}from"./firebase-rlQ0H13Y.js";import{d as n}from"./index-Ct5iqZMP.js";import"./ui-D5YrxJgA.js";import"./vendor-jcVos9IV.js";const r=async(r,o,s)=>{try{console.log("üè¢ updateCompanyFinancials ba≈ülatƒ±ldƒ±:",{reservationId:r,reservationData:o,financialResult:s});const{totalPrice:c,paymentMethod:l,customerInfo:m,tripDetails:d,manualDriverInfo:u,assignedDriver:p,assignedDriverId:v,driverId:f}=o,y=p||v||f;let g="Bilinmeyen ≈ûof√∂r",D=0,x=0,h="regular";if("manual"===y&&u)g=u.name,D=parseFloat(u.price)||0,x=c-D,h="manual";else if(y){const a=await e(t(n,"users",y));if(a.exists()){const e=a.data();g=`${e.firstName||""} ${e.lastName||""}`.trim();const t=c*(e.commission||20)/100;D=c-t,x=t}else console.error("≈ûof√∂r bulunamadƒ±:",y)}let k=0,$=0,A="";"cash"===l?(k=x,A=`Nakit rezervasyon geliri (≈üof√∂rden alƒ±nacak) - ${r}`):"card"!==l&&"credit_card"!==l||(k=c,$=D,A=`Kart rezervasyon geliri ve ≈üof√∂r √∂demesi - ${r}`);const I=t(n,"company_accounts","main_account");let N={};try{const t=await e(I);t.exists()&&(N=t.data())}catch(i){console.log("≈ûirket hesabƒ± getirilemedi, yeni olu≈üturulacak",i)}const w=N.totalRevenueToDate||0,R=N.totalExpensesToDate||0,_=N.reservationsRevenue||0,T=N.driverPayments||0,b=N.transactions||[],j=w+k,P=R+$,M=_+k,z=T+$,E={id:Date.now().toString(),type:"reservation_completed",revenueAmount:k,expenseAmount:$,netAmount:k-$,note:A,date:new Date,reservationId:r,paymentMethod:l,totalPrice:c,driverAmount:D,companyAmount:x,driverId:y,driverType:h,driverName:g,customerName:`${m.firstName} ${m.lastName}`,tripRoute:`${d.pickupLocation} ‚Üí ${d.dropoffLocation}`},F=[...b,E],L={totalRevenueToDate:j,totalExpensesToDate:P,reservationsRevenue:M,driverPayments:z,lastUpdated:new Date,transactions:F};return await a(t(n,"company_accounts","main_account"),L,{merge:!0}),console.log("≈ûirket finansal kaydƒ± g√ºncellendi:",{revenue:k,expense:$,netAmount:k-$,paymentMethod:l}),{success:!0,revenue:k,expense:$,netAmount:k-$,transaction:E}}catch(i){return console.error("≈ûirket finansal g√ºncelleme hatasƒ±:",i),{success:!1,error:i.message}}};export{r as updateCompanyFinancials};
